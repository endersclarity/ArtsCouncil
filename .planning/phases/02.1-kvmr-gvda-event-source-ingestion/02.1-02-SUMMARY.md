---
phase: 02.1-kvmr-gvda-event-source-ingestion
plan: 02
subsystem: data-pipeline
tags: [python, merge, dedup, events, github-actions, ci-cd]

# Dependency graph
requires:
  - phase: 02.1-kvmr-gvda-event-source-ingestion
    plan: 01
    provides: "KVMR iCal and GVDA Trumba JSON ingest scripts producing events-kvmr.json and events-gvda.json"
  - phase: 02-tier-2-events
    provides: "3-source merge pipeline, dedup logic, family classification, GitHub Actions workflow"
provides:
  - "5-source merge pipeline (trumba, gvda, libcal, kvmr, civicengage)"
  - "176 merged events (up from 120 with 3 sources)"
  - "19 GVDA/Trumba duplicates removed via fuzzy dedup"
  - "GitHub Actions daily cron with 5 ingest steps"
affects: [website-events-display, client-side-event-loading]

# Tech tracking
tech-stack:
  added: []
  patterns: ["5-source priority dedup: trumba > gvda > libcal > kvmr > civicengage"]

key-files:
  created: []
  modified:
    - scripts/events/merge_events.py
    - .github/workflows/refresh-events.yml

key-decisions:
  - "Source priority: trumba > gvda > libcal > kvmr > civicengage (Arts Council always wins dedup)"
  - "KVMR and GVDA are supplementary sources (continue-on-error in CI)"

patterns-established:
  - "Supplementary source pattern: new feeds get continue-on-error so pipeline never breaks"

# Metrics
duration: 2min
completed: 2026-02-15
---

# Phase 02.1 Plan 02: Merge Pipeline + GitHub Actions for 5 Event Sources Summary

**5-source merge pipeline producing 176 deduplicated events with 19 GVDA/Trumba overlaps removed, plus daily CI cron running all ingest scripts**

## Performance

- **Duration:** 2 min
- **Started:** 2026-02-15T18:19:55Z
- **Completed:** 2026-02-15T18:21:56Z
- **Tasks:** 2
- **Files modified:** 2

## Accomplishments
- Extended merge_events.py from 3 to 5 sources with correct dedup priority
- 176 total events (was 120 with 3 sources) -- 47% increase in event coverage
- 19 GVDA/Trumba duplicates correctly removed (Arts Council always wins)
- GitHub Actions workflow now runs all 5 ingest scripts daily with appropriate error handling

## Task Commits

Each task was committed atomically:

1. **Task 1: Extend merge_events.py for 5 sources** - `82ad5a5` (feat)
2. **Task 2: Update GitHub Actions workflow for 5 sources** - `ba7e58b` (feat)

## Files Created/Modified
- `scripts/events/merge_events.py` - Added KVMR/GVDA source loading, priority, CLI args, source type detection
- `.github/workflows/refresh-events.yml` - Added 2 ingest steps (KVMR iCal, GVDA Trumba JSON) with continue-on-error

## Decisions Made
- Source priority order: trumba(0) > gvda(1) > libcal(2) > kvmr(3) > civicengage(4) -- Arts Council Trumba always wins dedup
- KVMR and GVDA both marked supplementary (continue-on-error: true) so feed outages don't break the pipeline
- GVDA source_type fallback mapped to "json" (matches ingest_trumba_json.py output)

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
None.

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Phase 2.1 complete: all 5 event sources ingested, merged, and automated
- 176 events available for the Wednesday Feb 18 committee presentation
- Client-side code requires no changes (already handles merged JSON with source badges)
- Next focus: Phase 1 map rendering fix or Phase 3 design work

---
*Phase: 02.1-kvmr-gvda-event-source-ingestion*
*Completed: 2026-02-15*
