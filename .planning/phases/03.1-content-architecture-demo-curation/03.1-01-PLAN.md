---
phase: 03.1-content-architecture-demo-curation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - website/cultural-map-redesign-stitch-lab/index-maplibre-hero-intent-stitch-frontend-design-pass.html
  - website/cultural-map-redesign-stitch-lab/index-maplibre-hero-intent-stitch-frontend-design-pass.css
  - website/cultural-map-redesign-stitch-lab/index-maplibre-map-scroll-observer.js
  - website/cultural-map-redesign-stitch-lab/index-maplibre-config.js
  - website/cultural-map-redesign-stitch-lab/index-maplibre-bindings.js
autonomous: true
must_haves:
  truths:
    - "On desktop (>900px), hero zone shows content left and map right in a side-by-side split"
    - "Scrolling into editorial/MUSE sections causes the map to shrink to a narrow sidebar"
    - "Scrolling into the map zone causes the map to expand back to full or near-full width"
    - "Clicking 'View on map' in any context expands the map regardless of scroll position"
    - "Feature Picks tab shows hand-curated demo items from 5 different sources (MUSE, KVMR, GVDA, LibCal, downtown venue)"
    - "On mobile (<900px) the layout is single-column with map in a natural scroll position"
    - "All existing JS modules continue to work (no regressions in events, itineraries, chat, detail panel)"
  artifacts:
    - path: "website/cultural-map-redesign-stitch-lab/index-maplibre-map-scroll-observer.js"
      provides: "IntersectionObserver-driven map sizing logic"
    - path: "website/cultural-map-redesign-stitch-lab/index-maplibre-hero-intent-stitch-frontend-design-pass.css"
      provides: "Adaptive split-layout CSS with map sizing transitions"
    - path: "website/cultural-map-redesign-stitch-lab/index-maplibre-config.js"
      provides: "DEMO_FEATURED_PICKS array with curated items from each source"
  key_links:
    - from: "index-maplibre-map-scroll-observer.js"
      to: "index-maplibre-hero-intent-stitch-frontend-design-pass.css"
      via: "CSS class toggles (map-zone--hero, map-zone--editorial, map-zone--expanded)"
      pattern: "classList\\.(add|remove|toggle)"
    - from: "index-maplibre-bindings.js"
      to: "index-maplibre-map-scroll-observer.js"
      via: "CulturalMapScrollObserver.init() called from bindings"
      pattern: "CulturalMapScrollObserver"
---

<objective>
Restructure the hub page for a desktop split layout with an adaptive map that responds to scroll context, and curate hand-picked featured content from all 5 event sources for the Wednesday Feb 18 committee demo.

Purpose: The committee needs to see (1) a polished editorial layout where the map feels integrated rather than isolated, and (2) proof that this platform aggregates content from 5 sources that nobody else combines. The adaptive map makes the page feel like a living document — editorial when reading, spatial when exploring.

Output: Hub page with desktop split layout (content left, adaptive map right), IntersectionObserver-driven map sizing, and curated Feature Picks tab showcasing multi-source aggregation.
</objective>

<execution_context>
@C:/Users/ender/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ender/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.1-content-architecture-demo-curation/03.1-CONTEXT.md
@website/cultural-map-redesign-stitch-lab/index-maplibre-hero-intent-stitch-frontend-design-pass.html
@website/cultural-map-redesign-stitch-lab/index-maplibre-hero-intent-stitch-frontend-design-pass.css
@website/cultural-map-redesign-stitch-lab/index-maplibre-hero-intent.css
@website/cultural-map-redesign-stitch-lab/index-maplibre-config.js
@website/cultural-map-redesign-stitch-lab/index-maplibre-bindings.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restructure hub HTML/CSS for desktop split layout with adaptive map</name>
  <files>
    website/cultural-map-redesign-stitch-lab/index-maplibre-hero-intent-stitch-frontend-design-pass.html
    website/cultural-map-redesign-stitch-lab/index-maplibre-hero-intent-stitch-frontend-design-pass.css
    website/cultural-map-redesign-stitch-lab/index-maplibre-map-scroll-observer.js
  </files>
  <action>
    **CSS restructure for adaptive split layout (desktop >900px):**

    1. Wrap the entire content flow in a 2-column CSS grid: `grid-template-columns: 1fr var(--map-col-width)` where `--map-col-width` transitions between 3 sizes:
       - Hero zone: `minmax(380px, 45%)` — map is prominent, side-by-side with hero content
       - Editorial zone: `minmax(200px, 25%)` — map shrinks to narrow sidebar while reading editorials
       - Map zone: `minmax(500px, 65%)` — map expands to dominate when user scrolls to map section

    2. The map panel (`.panel` containing `#map`) becomes `position: sticky; top: 0; height: 100vh` so it stays visible during scroll. On the left column, content flows naturally: cover-grid → itinerary-hero → MUSE editorials → events → explore directory.

    3. Add a wrapper div around the left content column. The existing `.spread` section with `.panel` (map) and `.stack` (stories) needs restructuring:
       - Extract the map `.panel` OUT of `.spread` and place it as a sibling column
       - The `.stack` (stories) content merges into the main content flow
       - Add sentinel divs at section boundaries for IntersectionObserver: `<div class="scroll-sentinel" data-map-zone="hero"></div>`, `data-map-zone="editorial"`, `data-map-zone="map"`

    4. CSS transitions on the grid column width: `transition: grid-template-columns 0.4s cubic-bezier(0.4, 0, 0.2, 1)` for smooth map resizing.

    5. Mobile (<900px): Single column, no sticky map. Map sits in its natural document flow position between editorial and explore sections. Use `@media (max-width: 900px)` to reset grid to single column.

    **New JS module: `index-maplibre-map-scroll-observer.js`**

    Create an IIFE exposing `window.CulturalMapScrollObserver`:

    ```javascript
    (function() {
      'use strict';
      var ZONES = { hero: 'map-zone--hero', editorial: 'map-zone--editorial', expanded: 'map-zone--expanded' };
      var currentZone = 'hero';
      var wrap = null;

      function setZone(zone) {
        if (zone === currentZone) return;
        currentZone = zone;
        Object.values(ZONES).forEach(function(cls) { wrap.classList.remove(cls); });
        wrap.classList.add(ZONES[zone]);
      }

      function expandMap() {
        // Called from "View on map" actions
        setZone('expanded');
        var mapEl = document.getElementById('map');
        if (mapEl) mapEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }

      function init() {
        wrap = document.querySelector('.adaptive-layout') || document.querySelector('.wrap');
        if (!wrap || window.innerWidth < 900) return;

        var sentinels = document.querySelectorAll('.scroll-sentinel');
        if (!sentinels.length) return;

        var observer = new IntersectionObserver(function(entries) {
          entries.forEach(function(entry) {
            if (entry.isIntersecting) {
              var zone = entry.target.getAttribute('data-map-zone');
              if (zone) setZone(zone);
            }
          });
        }, { rootMargin: '-20% 0px -60% 0px' });

        sentinels.forEach(function(s) { observer.observe(s); });
        setZone('hero');
      }

      window.CulturalMapScrollObserver = { init: init, expandMap: expandMap, setZone: setZone };
    })();
    ```

    6. Add `<script src="index-maplibre-map-scroll-observer.js"></script>` to the HTML BEFORE `index-maplibre-bindings.js` in the script load order.

    7. In `index-maplibre-bindings.js`, add at the end of initialization: `if (window.CulturalMapScrollObserver) window.CulturalMapScrollObserver.init();`

    **HTML changes to the main file:**
    - Restructure: wrap content sections in `<div class="content-column">` and map panel in `<div class="map-column">`
    - Add `class="adaptive-layout"` to the outer wrapper
    - Add 3 sentinel divs: one before cover-grid (hero), one before MUSE section (editorial), one before exploreSection (map/expanded)
    - Move the `.panel` (map container) from inside `.spread` into the `map-column`
    - Keep all existing IDs and aria attributes intact

    **Do NOT:**
    - Break any existing JS module by removing DOM IDs
    - Remove the `.spread`, `.stack` classes — restyle them, don't delete
    - Add ES6 import/export — use IIFE pattern
  </action>
  <verify>
    Open the stitch-lab HTML locally in a browser at desktop width (>900px). Verify:
    1. Map panel appears on the right side and stays visible (sticky) as you scroll
    2. Scrolling through hero section: map takes ~45% width
    3. Scrolling through MUSE editorials: map shrinks to ~25% width
    4. Scrolling to explore section: map expands to ~65% width
    5. On mobile (resize to <600px): layout is single-column, map is not sticky
    6. No JS console errors from existing modules
  </verify>
  <done>Desktop shows adaptive 2-column layout with sticky map that resizes based on scroll context. Mobile falls back to single-column. All existing JS modules load without errors.</done>
</task>

<task type="auto">
  <name>Task 2: Curate featured demo picks from 5 sources and wire into Feature Picks tab</name>
  <files>
    website/cultural-map-redesign-stitch-lab/index-maplibre-config.js
    website/cultural-map-redesign-stitch-lab/index-maplibre-bindings.js
    website/cultural-map-redesign-stitch-lab/index-maplibre-hero-intent-stitch-frontend-design-pass.css
  </files>
  <action>
    **Curate demo featured picks — add to config.js:**

    Add a `DEMO_FEATURED_PICKS` array to `window.CulturalMapConfig` in `index-maplibre-config.js`. Each pick is an object:

    ```javascript
    { type: 'asset'|'event'|'editorial', name: '...', source: '...', tagline: '...', category: '...' }
    ```

    Hand-select 6-8 picks that prove 5-source aggregation. Selection criteria:
    - **MUSE editorial** (1-2): Pick a corridor or "Rural is the New Cool" — these are Arts Council voice
    - **KVMR event** (1): Pick a music/art event from KVMR feed (source_label="KVMR") — proves community radio aggregation
    - **GVDA event** (1): Pick a downtown event from GVDA feed (source_label="GVDA") — proves downtown association aggregation
    - **LibCal event** (1): Pick a library program (source_label="LibCal") — proves municipal aggregation
    - **Downtown venue/asset** (1-2): Pick from data.json — a gallery, restaurant, or performance space in Nevada City or Grass Valley downtown

    For assets, include the exact `n` (name) field from data.json so the detail panel deep link works.
    For events, include the `event_id` for linking.
    For editorials, include the MUSE card index for scroll-to behavior.

    **Wire picks into the Feature Picks tab:**

    The Feature Picks tab (`#intentFeaturePicksRow`) is already in the HTML but rendered dynamically. Find the existing JS that populates it (likely in `index-maplibre-bindings.js` or a hero-intent module) and modify it to:

    1. Read `CulturalMapConfig.DEMO_FEATURED_PICKS`
    2. For each pick, render an editorial-style card:
       - Source badge (colored pill): "MUSE", "KVMR", "GVDA", "Library", "Local"
       - Name/title
       - Tagline (1 line)
       - Category indicator
       - Click handler: assets open detail panel, events scroll to event in carousel, editorials scroll to MUSE card

    3. Style the source badges with distinct colors per source:
       - MUSE: gold (#c8943e)
       - KVMR: teal (#2a8a7a)
       - GVDA: rust (#b5533e)
       - LibCal: blue (#3a5f7c)
       - Local: deep-green (#2d4a3e)

    Add CSS for `.demo-pick-card` and `.demo-source-badge` to the design-pass CSS.

    **Do NOT:**
    - Build automated rotation — this is hand-curated for demo per user decision
    - Remove existing Feature Picks rendering logic — augment or replace with curated version
    - Include nature-forward picks — focus on downtown, galleries, dining, performances per user decision
  </action>
  <verify>
    Open the HTML locally and click the "Feature Picks" tab in the hero discovery section. Verify:
    1. 6-8 cards appear with source badges showing different colors
    2. At least one card from each source: MUSE, KVMR, GVDA, LibCal, and a local asset
    3. Clicking a local asset card opens the detail panel
    4. Source badges are visually distinct and readable
    5. Cards have editorial styling consistent with the magazine aesthetic
  </verify>
  <done>Feature Picks tab shows 6-8 hand-curated items from 5 sources with source attribution badges. Clicking items triggers appropriate navigation (detail panel for assets). Demo proves aggregation value.</done>
</task>

</tasks>

<verification>
1. Desktop (>900px): 2-column layout visible with content left, sticky map right
2. Scroll through page: map resizes at section boundaries (hero=45%, editorial=25%, map=65%)
3. Feature Picks tab: 6-8 curated cards with 5 distinct source badges
4. Mobile (<900px): single-column layout, no sticky map
5. All existing features work: events carousel, itinerary cards, chat widget, detail panel, explore directory
6. Zero new console errors
</verification>

<success_criteria>
- Hub page has adaptive split layout on desktop with map that responds to scroll context
- Feature Picks tab showcases 5-source aggregation with hand-curated demo content
- Mobile layout remains functional and readable
- No regressions in existing features
</success_criteria>

<output>
After completion, create `.planning/phases/03.1-content-architecture-demo-curation/03.1-01-SUMMARY.md`
</output>
