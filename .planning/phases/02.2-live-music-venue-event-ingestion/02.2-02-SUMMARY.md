---
phase: 02.2-live-music-venue-event-ingestion
plan: 02
subsystem: events
tags: [event-tagging, merge-pipeline, google-sheets, community-form, gspread]

requires:
  - phase: 02.1-kvmr-gvda-event-source-ingestion
    provides: "5-source merge pipeline with dedup and family classification"
provides:
  - "event_tags.json with 4 tag types (live-music, family-kids, arts-gallery, community)"
  - "9-source merge pipeline with auto-tagging and venue-specific dedup"
  - "Community form ingest script for Google Sheets integration"
  - "Public event submission page (submit-event.html)"
affects: [02.2-03, frontend-events-filter, github-actions]

tech-stack:
  added: [gspread, google-auth]
  patterns: [keyword-regex-tagging, venue-source-dedup-override, manual-vs-auto-tag-confidence]

key-files:
  created:
    - scripts/events/event_tags.json
    - scripts/events/ingest_community_form.py
    - website/cultural-map-redesign-stitch-lab/submit-event.html
  modified:
    - scripts/events/merge_events.py
    - scripts/requirements.txt

key-decisions:
  - "Event tags use keyword regex patterns with source-based defaults for venue sources"
  - "Venue-specific dedup override: crazyhorse source wins for Crazy Horse Saloon events regardless of general priority"
  - "Community form events get tag_confidence: manual (user-selected tags preserved as-is)"
  - "is_family backward compat: derived from family-kids tag presence, then legacy classifier fills gaps"
  - "Community ingest outputs empty array when credentials unavailable (pipeline stability)"

patterns-established:
  - "Tag confidence: manual (user-selected) vs auto (keyword-matched) vs source-default"
  - "VENUE_SOURCE_MAP pattern: venue sources override general dedup priority for their own events"

requirements-completed: [EVNT-03, EVNT-04, EVNT-05, EVNT-06]

duration: 4min
completed: 2026-02-17
---

# Phase 02.2 Plan 02: Event Tagging & Community Submission Summary

**Event type tagging system (4 tags with keyword regex + source defaults), 9-source merge pipeline with venue-specific dedup, community Google Sheets ingest script, and public event submission page**

## Performance

- **Duration:** 4 min
- **Started:** 2026-02-17T07:21:23Z
- **Completed:** 2026-02-17T07:25:19Z
- **Tasks:** 2
- **Files modified:** 5

## Accomplishments
- event_tags.json defines live-music, family-kids, arts-gallery, community tags with regex patterns and source defaults
- merge_events.py extended to 9 sources with auto-tagging (166 of 280 events tagged on first run)
- Venue-specific dedup override ensures crazyhorse/goldenera/bodhihive win for events at their own venues
- Community form ingest script handles Google Sheets with graceful fallback when credentials unavailable
- submit-event.html provides editorial-styled submission page with Google Form embed placeholder

## Task Commits

Each task was committed atomically:

1. **Task 1: Create event_tags.json and integrate tagging into merge_events.py** - `668c0f2` (feat)
2. **Task 2: Create community form ingest script and event submission page** - `30d3012` (feat)

## Files Created/Modified
- `scripts/events/event_tags.json` - Tag definitions with keyword patterns and source defaults
- `scripts/events/merge_events.py` - Extended merge pipeline: 9 sources, auto-tagging, venue-specific dedup
- `scripts/requirements.txt` - Added gspread and google-auth dependencies
- `scripts/events/ingest_community_form.py` - Google Sheets reader for community-submitted events
- `website/cultural-map-redesign-stitch-lab/submit-event.html` - Public event submission page

## Decisions Made
- Event tags use keyword regex patterns with source-based defaults (crazyhorse, goldenera, bodhihive auto-tagged as live-music)
- Venue-specific dedup override: when event venue fuzzy-matches a source's home venue, that source wins regardless of general priority
- Community form events marked tag_confidence: "manual" so user-selected tags are preserved through auto-tagging
- is_family backward compatibility maintained: derived from family-kids tag, then legacy classifier fills remaining
- Community ingest gracefully outputs empty array when credentials or gspread unavailable

## Deviations from Plan

None - plan executed exactly as written.

## User Setup Required

**External services require manual configuration.** The following setup is needed before community form ingestion works:
- Create Google Form with specified fields (Event Name, Date, Start Time, etc.)
- Link form to Google Sheet, add 'status' and 'notes' columns
- Create Google Cloud service account with Sheets API access
- Share Google Sheet with service account email
- Set GOOGLE_SERVICE_ACCOUNT_JSON and COMMUNITY_SHEET_ID environment variables
- Add secrets to GitHub Actions for CI pipeline

## Next Phase Readiness
- Tagging system ready for frontend filter UI integration
- merge_events.py accepts 4 new source files (currently empty/missing, will be populated by Plan 01 scrapers)
- Community pipeline ready pending Google Form/Sheet setup by user
- Plan 03 (GitHub Actions CI) can wire all 9 sources together

---
*Phase: 02.2-live-music-venue-event-ingestion*
*Completed: 2026-02-17*
