---
phase: 02.2-live-music-venue-event-ingestion
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - website/cultural-map-redesign-stitch-lab/data.json
  - scripts/events/ingest_squarespace_events.py
  - website/cultural-map-redesign-stitch-lab/events-merged-flat.json
autonomous: true
requirements: []
gap_closure: true

must_haves:
  truths:
    - "Bodhi Hive, Stardust Station, and The Unchurch render with Performing Arts category color (not grey #999)"
    - "Golden Era source filter shows Golden Era events (not 0 events)"
    - "Bodhi Hive source filter shows Bodhi Hive events when they exist"
  artifacts:
    - path: "website/cultural-map-redesign-stitch-lab/data.json"
      provides: "3 venues with l='Performance Spaces' (fixed from 'Performing Arts')"
      pattern: '"n":"Bodhi Hive".*"l":"Performance Spaces"'
    - path: "scripts/events/ingest_squarespace_events.py"
      provides: "Parameterized source_type using source_name variable"
      pattern: "'source_type': source_name"
    - path: "website/cultural-map-redesign-stitch-lab/events-merged-flat.json"
      provides: "Golden Era events with source_type='goldenera' (not 'squarespace')"
      pattern: '"source_type":"goldenera"'
  key_links:
    - from: "scripts/events/ingest_squarespace_events.py"
      to: "website/cultural-map-redesign-stitch-lab/events-merged-flat.json"
      via: "merge pipeline regeneration"
      pattern: "python.*ingest_squarespace.*python.*merge_events"
    - from: "website/cultural-map-redesign-stitch-lab/events-merged-flat.json"
      to: "index-maplibre-events-model.js"
      via: "source filter matching source_type field"
      pattern: 'source_type.*goldenera'
---

<objective>
Fix UAT gaps: correct category name mismatch for 3 performing arts venues (grey color issue) and fix Squarespace ingest source_type hardcoding (broken source filters).

Purpose: Close UAT validation failures so all venues render with correct category colors and all source filters work correctly.

Output: data.json with corrected category names, ingest_squarespace_events.py with parameterized source_type, regenerated events-merged-flat.json with correct source_type values.
</objective>

<execution_context>
@C:/Users/ender/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ender/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02.2-live-music-venue-event-ingestion/02.2-UAT.md
@.planning/phases/02.2-live-music-venue-event-ingestion/02.2-01-SUMMARY.md
@.planning/phases/02.2-live-music-venue-event-ingestion/02.2-02-SUMMARY.md
@.planning/phases/02.2-live-music-venue-event-ingestion/02.2-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix category name mismatch in data.json</name>
  <files>website/cultural-map-redesign-stitch-lab/data.json</files>
  <action>
Open data.json and find the 3 venues identified in UAT Gap 1:
- Bodhi Hive
- Stardust Station
- The Unchurch

Change their category field from "l":"Performing Arts" to "l":"Performance Spaces" (exact match to config CATS object).

Preserve all other fields unchanged (coordinates, address, description, etc). These are the only 3 venues with this category mismatch â€” all other venues already use correct category names from config.

GAP CONTEXT: The config defines "Performance Spaces" but these 3 venues were added in 02.2-01 using "Performing Arts". The category lookup falls back to grey #999 when no match found. Frontend rendering works; color lookup fails.
  </action>
  <verify>
Grep for the fixed category values:

```bash
grep -E '"n":"(Bodhi Hive|Stardust Station|The Unchurch)"' website/cultural-map-redesign-stitch-lab/data.json | grep '"l":"Performance Spaces"'
```

Should return 3 lines (one per venue). No lines should show "Performing Arts" for these venues.
  </verify>
  <done>
All 3 venues (Bodhi Hive, Stardust Station, The Unchurch) have category "Performance Spaces" in data.json. Grep verification confirms 3 matches with correct category name.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix Squarespace source_type hardcoding and regenerate merged events</name>
  <files>scripts/events/ingest_squarespace_events.py, website/cultural-map-redesign-stitch-lab/events-merged-flat.json</files>
  <action>
**PART A: Fix ingest script**

Open scripts/events/ingest_squarespace_events.py and find line 167 (inside the event normalization loop where individual events are built).

Change from:
```python
'source_type': 'squarespace'
```

To:
```python
'source_type': source_name
```

This makes source_type use the --source-name CLI parameter (goldenera, bodhihive) instead of the generic 'squarespace' value.

GAP CONTEXT: The script accepts --source-name parameter for output filename and source_label, but hardcodes source_type to 'squarespace'. Frontend filters by source_type field, so 'source:goldenera' filter finds 0 events because all Golden Era events have source_type='squarespace'. Same issue will affect Bodhi Hive when they add events.

**PART B: Regenerate merged events**

Run the full ingest + merge pipeline to regenerate events-merged-flat.json with correct source_type values:

```bash
cd scripts/events

# Re-ingest Golden Era and Bodhi Hive with fixed script
python ingest_squarespace_events.py \
  --site-url https://www.goldeneralounge.com \
  --source-name goldenera \
  --output-file ../../website/cultural-map-redesign-stitch-lab/events-goldenera.json

python ingest_squarespace_events.py \
  --site-url https://www.bodhihive.com \
  --source-name bodhihive \
  --output-file ../../website/cultural-map-redesign-stitch-lab/events-bodhihive.json

# Re-run merge pipeline
python merge_events.py \
  --trumba ../../website/cultural-map-redesign-stitch-lab/events-trumba.json \
  --gvda ../../website/cultural-map-redesign-stitch-lab/events-gvda.json \
  --libcal ../../website/cultural-map-redesign-stitch-lab/events-libcal.json \
  --kvmr ../../website/cultural-map-redesign-stitch-lab/events-kvmr.json \
  --crazyhorse ../../website/cultural-map-redesign-stitch-lab/events-crazyhorse.json \
  --goldenera ../../website/cultural-map-redesign-stitch-lab/events-goldenera.json \
  --bodhihive ../../website/cultural-map-redesign-stitch-lab/events-bodhihive.json \
  --civicengage ../../website/cultural-map-redesign-stitch-lab/events-civicengage.json \
  --output ../../website/cultural-map-redesign-stitch-lab/events-merged-flat.json
```

The merge pipeline will now see Golden Era events with source_type='goldenera' instead of 'squarespace'. Frontend source filters will work correctly.
  </action>
  <verify>
**Verify script fix:**
```bash
grep "'source_type': source_name" scripts/events/ingest_squarespace_events.py
```
Should return line 167 with parameterized source_type.

**Verify Golden Era events in merged file:**
```bash
grep -c '"source_type":"goldenera"' website/cultural-map-redesign-stitch-lab/events-merged-flat.json
```
Should return count > 0 (Golden Era has 6 events per 02.2-UAT.md).

**Verify no hardcoded 'squarespace' remains:**
```bash
grep -c '"source_type":"squarespace"' website/cultural-map-redesign-stitch-lab/events-merged-flat.json
```
Should return 0 (no events should use generic 'squarespace' value).
  </verify>
  <done>
Line 167 in ingest_squarespace_events.py uses parameterized source_name. events-merged-flat.json contains Golden Era events with source_type='goldenera'. No events have source_type='squarespace'. Frontend source filters for Golden Era and Bodhi Hive will now work correctly.
  </done>
</task>

</tasks>

<verification>
**Gap 1 closure (category color):**
```bash
# Load map and check rendered marker color for Bodhi Hive via browser dev tools
# Expected: Performing Arts category color (not grey #999)
# Automated check not feasible (requires browser rendering)
```

**Gap 2+3 closure (source filters):**
```bash
# Open events dropdown, select "Source: Golden Era"
# Expected: 6 events displayed, scope label shows "Source: Golden Era"
# Automated check: verify source_type field in merged JSON
grep -E '"source_type":"(goldenera|bodhihive)"' website/cultural-map-redesign-stitch-lab/events-merged-flat.json | wc -l
# Should return count >= 6 (Golden Era events)
```

**Full UAT retest:**
Re-run UAT Tests 1, 4, and 6 from 02.2-UAT.md to confirm:
- Test 1: Performing Arts venues render with category color
- Test 4: Golden Era source filter shows Golden Era events
- Test 6: All source filters correctly isolate their source's events
</verification>

<success_criteria>
**Plan complete when:**
- [ ] data.json has 3 venues with category "Performance Spaces" (was "Performing Arts")
- [ ] ingest_squarespace_events.py line 167 uses `source_name` variable (not hardcoded string)
- [ ] events-merged-flat.json contains Golden Era events with source_type='goldenera'
- [ ] events-merged-flat.json contains 0 events with source_type='squarespace'
- [ ] All verification commands pass
- [ ] Changes committed to git

**Observable truths from UAT:**
- Bodhi Hive, Stardust Station, The Unchurch map markers render with Performing Arts category color (not grey)
- Golden Era source filter in events dropdown returns 6 events (not 0)
- Bodhi Hive source filter works correctly (currently 0 events, but filter logic valid)
</success_criteria>

<output>
After completion, create `.planning/phases/02.2-live-music-venue-event-ingestion/02.2-04-SUMMARY.md`

Include:
- Files modified count (3)
- Gaps closed (3 UAT gaps, 2 distinct fixes)
- Verification results for both category rendering and source filters
- Confirmation that Phase 02.2 is now UAT-verified complete
</output>
