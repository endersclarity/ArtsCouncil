---
phase: 02.2-live-music-venue-event-ingestion
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - website/cultural-map-redesign-stitch-lab/data.json
  - scripts/events/venue_aliases.json
  - scripts/events/ingest_crazyhorse_ical.py
  - scripts/events/ingest_squarespace_events.py
autonomous: true
requirements:
  - EVNT-01
  - EVNT-02

must_haves:
  truths:
    - "data.json contains Bodhi Hive, The Fern, Stardust Station, and The Unchurch as new venue entries"
    - "data.json no longer contains any Ol' Republic entries (Brewery or Roadhouse)"
    - "Running ingest_crazyhorse_ical.py produces events-crazyhorse.json with upcoming events"
    - "Running ingest_squarespace_events.py with Golden Era URL produces events-goldenera.json"
    - "Running ingest_squarespace_events.py with Bodhi Hive URL produces events-bodhihive.json (may be empty)"
    - "Venue aliases map new venue name variants to canonical asset names"
  artifacts:
    - path: "website/cultural-map-redesign-stitch-lab/data.json"
      provides: "4 new venues added, 2 Ol' Republic entries removed"
      contains: "Bodhi Hive"
    - path: "scripts/events/ingest_crazyhorse_ical.py"
      provides: "Crazy Horse Saloon iCal ingest (Source 6)"
    - path: "scripts/events/ingest_squarespace_events.py"
      provides: "Parameterized Squarespace JSON ingest for Golden Era (Source 7) and Bodhi Hive (Source 8)"
    - path: "scripts/events/venue_aliases.json"
      provides: "Venue name aliases for new venues"
  key_links:
    - from: "scripts/events/ingest_crazyhorse_ical.py"
      to: "website/cultural-map-redesign-stitch-lab/events-crazyhorse.json"
      via: "iCal fetch and parse to JSON output"
      pattern: "events-crazyhorse\\.json"
    - from: "scripts/events/ingest_squarespace_events.py"
      to: "website/cultural-map-redesign-stitch-lab/events-goldenera.json"
      via: "Squarespace JSON fetch with --site-url parameter"
      pattern: "events-goldenera\\.json"
---

<objective>
Add 4 missing live music venues to the asset data, remove 2 closed Ol' Republic entries, and create ingest scripts for Crazy Horse iCal (Source 6) and Squarespace JSON for Golden Era + Bodhi Hive (Sources 7-8).

Purpose: Expand venue coverage to include Nevada County's live music scene and create the data pipeline scripts that feed the merge system.
Output: Updated data.json, 2 new ingest scripts, updated venue aliases.
</objective>

<execution_context>
@C:/Users/ender/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ender/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/02.2-live-music-venue-event-ingestion/02.2-RESEARCH.md
@scripts/events/ingest_kvmr_ical.py
@scripts/events/venue_aliases.json
@website/cultural-map-redesign-stitch-lab/data.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update data.json with 4 new venues and remove Ol' Republic</name>
  <files>website/cultural-map-redesign-stitch-lab/data.json, scripts/events/venue_aliases.json</files>
  <action>
  1. Open `website/cultural-map-redesign-stitch-lab/data.json` and add 4 new venue entries with full parity (all fields matching existing asset format with single-letter keys):

  Bodhi Hive:
  - n: "Bodhi Hive", a: "420 Providence Mine Road", c: "Nevada City", l: "Performing Arts"
  - w: "https://www.bodhi-hive.com", p: "", d: "Multi-use arts and event space on Providence Mine Road. Hosts live music, screenings, discussions, and community gatherings."
  - x: -121.0350839, y: 39.2562206

  The Fern:
  - n: "The Fern", a: "235 Commercial St", c: "Nevada City", l: "Eat, Drink & Stay"
  - w: "https://thefernnevadacity.com/", p: "", d: "Bar and live music venue in downtown Nevada City. Hosts live bands, DJs, open mic nights, and pub quiz."
  - x: -121.0175, y: 39.2631

  Stardust Station:
  - n: "Stardust Station", a: "", c: "Nevada City", l: "Performing Arts"
  - w: "https://starduststation.com/", p: "", d: "Vintage shop and occasional music/art venue in Nevada City. Hosts eclectic live performances and community events."
  - x: -121.019, y: 39.263

  The Unchurch:
  - n: "The Unchurch", a: "220 Bresee Place", c: "Grass Valley", l: "Performing Arts"
  - w: "", p: "", d: "Community event space in Grass Valley. Hosts live music and art events, primarily through KVMRx programming."
  - x: -121.06, y: 39.22

  2. Remove BOTH Ol' Republic entries by searching for venue names containing "Republic":
  - "Ol' Republic Brewery" (Nevada City, Eat, Drink & Stay)
  - "Ol' Republic Roadhouse" (Nevada City, Eat, Drink & Stay)
  Verify post-edit count: original count - 2 + 4 = original count + 2.

  3. Update `scripts/events/venue_aliases.json` to add aliases for the new venues:
  - "Bodhi-Hive" -> "Bodhi Hive" (Squarespace uses hyphen)
  - "Crazy Horse Saloon & Grill" -> "Crazy Horse Saloon & Grill" (confirm existing entry or add)
  - "Golden Era Lounge" -> "Golden Era Lounge"
  - "The Fern" -> "The Fern"

  Category mapping per locked decision: Bodhi Hive = Performing Arts, The Fern = Eat/Drink/Stay, Stardust Station = Performing Arts, The Unchurch = Performing Arts.
  </action>
  <verify>
  Run: `python -c "import json; d=json.load(open('website/cultural-map-redesign-stitch-lab/data.json')); names=[x['n'] for x in d]; print(f'Total: {len(d)}'); assert 'Bodhi Hive' in names; assert 'The Fern' in names; assert 'Stardust Station' in names; assert 'The Unchurch' in names; assert not any('Republic' in n for n in names); print('PASS')"` from project root.
  </verify>
  <done>data.json has 4 new venues (Bodhi Hive, The Fern, Stardust Station, The Unchurch) with correct categories and no Ol' Republic entries. venue_aliases.json has mappings for new venue name variants.</done>
</task>

<task type="auto">
  <name>Task 2: Create Crazy Horse iCal and Squarespace JSON ingest scripts</name>
  <files>scripts/events/ingest_crazyhorse_ical.py, scripts/events/ingest_squarespace_events.py</files>
  <action>
  1. Create `scripts/events/ingest_crazyhorse_ical.py` by cloning the KVMR iCal pattern (`ingest_kvmr_ical.py`):
  - URL: `https://crazyhorsenc.com/?post_type=tribe_events&ical=1&eventDisplay=list`
  - source_type: "crazyhorse"
  - source_label: "Crazy Horse Saloon"
  - Output file: `website/cultural-map-redesign-stitch-lab/events-crazyhorse.json`
  - Same structure: fetch iCal -> parse with icalendar + recurring_ical_events -> output JSON array
  - Timezone: America/Los_Angeles
  - Same error handling: requests.get with timeout, try/except, continue-on-error for individual events
  - Set is_family: False for all events (it's a saloon)

  2. Create `scripts/events/ingest_squarespace_events.py` as a parameterized script:
  - Accept CLI args: `--site-url` (base URL), `--source-name` (e.g. "goldenera"), `--output-file` (path)
  - Fetch `{site_url}/events?format=json` with requests.get, timeout=30
  - Parse the `upcoming` array from JSON response
  - For each event: extract title, startDate (EPOCH MILLISECONDS / 1000), endDate, location.addressTitle, location.addressLine1, location.addressLine2, fullUrl, urlId
  - Generate event_id as `{source_name}-{urlId}` or fallback `{source_name}-{YYYYMMDDHHMM}`
  - Set source_type: "squarespace", source_ref: site URL, source_label: venue name from location.addressTitle
  - Set is_family: False (music venues)
  - Build ticket_url from fullUrl: `{site_url}{fullUrl}`
  - Output JSON in same format as other ingest scripts
  - Handle empty upcoming array gracefully (output `[]`)
  - Default outputs when called without args: print usage

  Usage examples (document in script docstring):
  ```
  python ingest_squarespace_events.py --site-url https://www.goldeneralounge.com --source-name goldenera --output-file website/cultural-map-redesign-stitch-lab/events-goldenera.json
  python ingest_squarespace_events.py --site-url https://www.bodhi-hive.com --source-name bodhihive --output-file website/cultural-map-redesign-stitch-lab/events-bodhihive.json
  ```
  </action>
  <verify>
  Run from project root:
  1. `python scripts/events/ingest_crazyhorse_ical.py` -- should produce events-crazyhorse.json with events
  2. `python scripts/events/ingest_squarespace_events.py --site-url https://www.goldeneralounge.com --source-name goldenera --output-file website/cultural-map-redesign-stitch-lab/events-goldenera.json` -- should produce events-goldenera.json
  3. `python scripts/events/ingest_squarespace_events.py --site-url https://www.bodhi-hive.com --source-name bodhihive --output-file website/cultural-map-redesign-stitch-lab/events-bodhihive.json` -- should produce events-bodhihive.json (may be empty array)
  4. Verify JSON structure: `python -c "import json; d=json.load(open('website/cultural-map-redesign-stitch-lab/events-crazyhorse.json')); print(f'{len(d)} Crazy Horse events'); assert all('event_id' in e and 'title' in e for e in d)"`
  </verify>
  <done>Two ingest scripts produce valid JSON event files. Crazy Horse iCal script fetches and parses WordPress Events Calendar feed. Squarespace script is parameterized and works for both Golden Era and Bodhi Hive.</done>
</task>

</tasks>

<verification>
1. data.json venue count is correct (original + 2 net)
2. No Ol' Republic entries remain in data.json
3. All 4 new venues have correct category assignments per locked decisions
4. Crazy Horse ingest produces valid events JSON with source_type "crazyhorse"
5. Golden Era ingest produces valid events JSON with source_type "squarespace" and source_name "goldenera"
6. Bodhi Hive ingest runs without error even with 0 upcoming events
7. venue_aliases.json has entries for Bodhi-Hive -> Bodhi Hive mapping
</verification>

<success_criteria>
- 4 new venues appear on the map when data.json is loaded
- 3 new ingest scripts produce valid JSON output files
- All scripts follow existing patterns (same JSON structure, error handling, timezone handling)
</success_criteria>

<output>
After completion, create `.planning/phases/02.2-live-music-venue-event-ingestion/02.2-01-SUMMARY.md`
</output>
