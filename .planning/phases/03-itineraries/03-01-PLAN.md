---
phase: 03-itineraries
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - website/cultural-map-redesign/itineraries.json
  - website/cultural-map-redesign/index-maplibre-itinerary-model.js
  - website/cultural-map-redesign/index-maplibre-itinerary-calendar.js
autonomous: true

must_haves:
  truths:
    - "Three authored itineraries exist with correct asset name references that resolve against data.json"
    - "Itinerary model can resolve stops to data.json assets by exact name match"
    - "Google Calendar URL generation produces valid timezone-aware links for any stop"
  artifacts:
    - path: "website/cultural-map-redesign/itineraries.json"
      provides: "Three authored itineraries (1-day, 2-day, 3-day) with days[].stops[] structure"
      contains: "perfect-day"
    - path: "website/cultural-map-redesign/index-maplibre-itinerary-model.js"
      provides: "Stop resolution, day grouping, itinerary lookup by ID"
      exports: ["resolveItineraryStops", "getItineraryById", "getAllItineraries"]
    - path: "website/cultural-map-redesign/index-maplibre-itinerary-calendar.js"
      provides: "Google Calendar URL generation per stop"
      exports: ["buildGoogleCalendarUrl", "getNextSaturday"]
  key_links:
    - from: "itineraries.json"
      to: "data.json"
      via: "exact asset name match in stop.asset field"
      pattern: "asset\\.n.*toLowerCase.*===.*stop\\.asset.*toLowerCase"
---

<objective>
Create the itinerary data layer: authored JSON content for 3 itineraries, a model module for stop resolution and data access, and a calendar utility for Google Calendar URL generation.

Purpose: Establishes the data foundation that the view/controller (Plan 02) will consume. All three files are pure data/logic with no DOM or map dependencies, enabling isolated development and testing.

Output: `itineraries.json` with 3 itineraries, `itinerary-model.js` with stop resolution, `itinerary-calendar.js` with calendar URL builder.
</objective>

<execution_context>
@C:/Users/ender/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ender/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-itineraries/03-RESEARCH.md
@website/cultural-map-redesign/data.json
@website/cultural-map-redesign/experiences.json
@website/cultural-map-redesign/index-maplibre-experience-model.js
@website/cultural-map-redesign/index-maplibre-core-utils.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Author itineraries.json with 3 curated trip plans</name>
  <files>website/cultural-map-redesign/itineraries.json</files>
  <action>
Create `itineraries.json` with 3 itineraries following the schema from research. Each itinerary has: id, title, subtitle, duration, season, heroImage (use empty string for now), description, theme (accent, routeColor, background), and days[] array with stops[].

**1-Day: "Arts & Nature: A Perfect Day"** (id: `perfect-day`, 6-8 stops)
- Theme: teal accent (#2a8c8c), rust route (#b85c38), warm cream bg (#f2ece4)
- Morning: Empire Mine State Historic Park (09:00, 90min), Miners Foundry (11:00, 45min)
- Midday: California Organics Restaurant & Gallery (12:00, 75min), Pioneer Park (13:30, 45min)
- Afternoon: Nevada Theatre (14:30, 60min), Center for the Arts (16:00, 60min)
- Evening: Optional: one dining/gallery stop if a good match exists in data.json

**2-Day: "The Full Nevada County Experience"** (id: `full-experience`, 12-14 stops)
- Theme: deep green accent (#2d5a27), gold route (#c8943e), cream bg (#f5f0e8)
- Day 1 (Grass Valley focus): Empire Mine, downtown walk (Holbrooke Hotel or Mill Street), Miners Foundry, dining
- Day 2 (Nevada City + Eastern county): Nevada City walking tour (Broad Street galleries, Nevada Theatre), Bridgeport Covered Bridge, South Yuba River State Park, North Star Mining Museum

**3-Day: "Deep Dive: Art, History & Wine"** (id: `art-history-wine`, 15-18 stops)
- Theme: wine/burgundy accent (#8b2252), sage route (#7a9e7e), linen bg (#faf6f0)
- Day 1 (History): Empire Mine, North Star Mining Museum, Firehouse No. 1 Museum, Miners Foundry
- Day 2 (Art): Grass Valley/NC galleries, Center for the Arts, Nevada Theatre, studio visits
- Day 3 (Wine + Nature): Lucchesi Vineyards or other wineries in data.json, trails, scenic drives

**CRITICAL:** Every `stop.asset` value MUST exactly match an asset's `n` field in `data.json`. Before writing, grep data.json for the exact names. Do NOT guess names. Each stop has: asset (exact name), time (HH:MM 24h), duration (minutes), narrative (2-3 sentences, editorial voice), tip (optional practical advice).

Each day has: label ("Day 1", "Day 2", etc.) and stops array.
  </action>
  <verify>
Parse itineraries.json with `JSON.parse()`. Verify:
1. Array of 3 objects
2. Each has id, title, days[]
3. All stop.asset values exist in data.json (cross-reference with grep/search)
4. No duplicate stops within same itinerary
5. Times are in HH:MM 24h format
6. Durations are positive integers
  </verify>
  <done>Three well-authored itineraries with valid asset references, editorial narratives, and sensible time scheduling</done>
</task>

<task type="auto">
  <name>Task 2: Create itinerary-model.js and itinerary-calendar.js modules</name>
  <files>
website/cultural-map-redesign/index-maplibre-itinerary-model.js
website/cultural-map-redesign/index-maplibre-itinerary-calendar.js
  </files>
  <action>
**itinerary-model.js** — IIFE exposing `window.CulturalMapItineraryModel`:

1. `getAllItineraries(itineraries)` — returns the full array (trivial but consistent API)
2. `getItineraryById(itineraries, id)` — find by id string, return null if not found
3. `resolveItineraryStops(itinerary, data)` — iterate days[].stops[], match each stop.asset against data[].n using **exact case-insensitive match** (not `.includes()`). Return flat array of resolved stops, each with: original stop fields + `data` (matched asset object) + `dayIndex` (0-based) + `dayLabel` (from day.label). Skip unresolved stops (log warning to console).
4. `getItineraryDays(itinerary)` — returns itinerary.days with stop counts per day
5. `flattenStopsForMap(resolved)` — returns array of {lng: stop.data.x, lat: stop.data.y, name: stop.data.n, stopNumber: index+1} for map rendering (same shape corridor-map expects)

Use ES5 IIFE pattern. No imports, no dependencies except console.warn for unresolved stops.

**itinerary-calendar.js** — IIFE exposing `window.CulturalMapItineraryCalendar`:

1. `buildGoogleCalendarUrl({ title, startDate, startTime, durationMinutes, location, description, timezone })` — constructs Google Calendar URL per the research doc pattern. Default timezone to 'America/Los_Angeles'. `startDate` is 'YYYY-MM-DD', `startTime` is 'HH:MM' (24h). Calculate end time by adding durationMinutes. URL-encode all text values. Return full URL string.
2. `getNextSaturday()` — returns next Saturday as 'YYYY-MM-DD' string. Uses `new Date()` for simplicity (calendar export is not timezone-critical since Google Calendar handles the ctz parameter). If today IS Saturday, return today.
3. `buildStopCalendarUrl(stop, itinerary, dateStr)` — convenience wrapper that calls buildGoogleCalendarUrl with stop.data.n as title suffix, stop.data.a + ', ' + stop.data.c + ', CA' as location, stop.narrative as description. `dateStr` defaults to getNextSaturday().

Use ES5 IIFE pattern. No external dependencies.
  </action>
  <verify>
1. Both files parse without syntax errors (load in Node.js or browser console)
2. window.CulturalMapItineraryModel exposes: getAllItineraries, getItineraryById, resolveItineraryStops, getItineraryDays, flattenStopsForMap
3. window.CulturalMapItineraryCalendar exposes: buildGoogleCalendarUrl, getNextSaturday, buildStopCalendarUrl
4. buildGoogleCalendarUrl returns a URL starting with 'https://calendar.google.com/calendar/render?action=TEMPLATE'
5. URL contains ctz=America/Los_Angeles
  </verify>
  <done>Two pure-logic modules ready for consumption by Plan 02's view/controller. No DOM, no MapLibre, no GSAP dependencies.</done>
</task>

</tasks>

<verification>
1. `itineraries.json` is valid JSON with 3 itineraries
2. Every stop.asset in itineraries.json matches exactly one asset.n in data.json
3. Both JS modules define their window.CulturalMap* exports
4. Google Calendar URL output is well-formed
5. No new external dependencies introduced
</verification>

<success_criteria>
- Three authored itineraries (1-day, 2-day, 3-day) with editorial narratives and exact data.json asset references
- itinerary-model.js resolves stops by exact name match and exposes a clean API
- itinerary-calendar.js generates valid Google Calendar URLs with Pacific timezone
- All three files are standalone (no DOM, no map) and ready for Plan 02 integration
</success_criteria>

<output>
After completion, create `.planning/phases/03-itineraries/03-01-SUMMARY.md`
</output>
